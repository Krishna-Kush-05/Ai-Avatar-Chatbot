{% extends "app_layout.html" %}

{% block app_content %}
<div class="page-header">
    <h1>Welcome, {{ current_user.get_display_name() }}!</h1>
    <p>This is your central dashboard. Configure assistants and manage users from here.</p>
</div>

<!-- Main 2-column grid -->
<div class="main-content-grid">
    
    <!-- Left Column -->
    <div class="main-column">
        
        <!-- Configure New Assistant -->
        <div class="card">
            <div class="card-header">
                <h3>Configure New AI Assistant</h3>
            </div>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <div class="card-body">
                    {{ bot_form.hidden_tag() }}
                    
                    <div class="form-group">
                        {{ bot_form.bot_name.label }}
                        {{ bot_form.bot_name(class="form-control", placeholder="e.g., 'Biology 101 Assistant'") }}
                    </div>
                    
                    <div class="form-group">
                        {{ bot_form.bot_desc.label }}
                        {{ bot_form.bot_desc(class="form-control", placeholder="e.g., 'Answers student questions about the syllabus.'") }}
                    </div>

                    <div class="form-group">
                        {{ bot_form.bot_domain.label }}
                        {{ bot_form.bot_domain(class="form-control") }}
                    </div>
                    
                    <div class="form-group">
                        {{ bot_form.website_url.label }} <span class="coming-soon-label">Coming Soon</span>
                        {{ bot_form.website_url(class="form-control", placeholder="http://example.com/info", disabled=true) }}
                    </div>
                </div>
                <div class="card-footer" style="text-align: right;">
                    {{ bot_form.submit_bot(class="btn btn-primary") }}
                </div>
            </form>
        </div>

        <!-- My AI Assistants -->
        <div class="card">
            <div class="card-header">
                <h3>My AI Assistants</h3>
            </div>
            <div class="card-body" style="padding: 0;">
                <ul class="item-list">
                    {% if bots %}
                        {% for bot in bots %}
                            <li class="item-list-entry">
                                <div>
                                    <span class="item-list-entry-name">{{ bot.name }}</span>
                                    <span class="item-list-entry-details">
                                        Domain: {{ bot.domain.title() }} | Knowledge Files: {{ bot.pdfs|length }}
                                    </span>
                                </div>
                                <div class="item-list-entry-actions">
                                    <a href="#" class="btn btn-sm btn-outline">Manage</a>
                                </div>
                            </li>
                        {% endfor %}
                    {% else %}
                        <li class="item-list-entry">
                            <p style="color: var(--color-text-light); margin: 0;">You haven't configured any assistants yet.</p>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>

    </div>
    
    <!-- Right Column (Sidebar) -->
    <div class="sidebar-column">
        
        <!-- Organization Details -->
        <div class="card">
            <div class="card-header">
                <h3>Organization Details</h3>
            </div>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <div class="card-body">
                    {{ org_form.hidden_tag() }}
                    <div class="form-group">
                        {{ org_form.institution_name.label }}
                        {{ org_form.institution_name(class="form-control", placeholder="e.g., 'Springfield University'") }}
                    </div>
                </div>
                <div class="card-footer" style="text-align: right;">
                    {{ org_form.submit_org(class="btn btn-secondary btn-sm") }}
                </div>
            </form>
        </div>

        <!-- Invite Students -->
        <div class="card">
            <div class="card-header">
                <h3>Invite Students</h3>
            </div>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <div class="card-body">
                    {{ invite_form.hidden_tag() }}
                    <div class="form-group">
                        {{ invite_form.student_email.label }}
                        {{ invite_form.student_email(class="form-control", placeholder="student@example.com") }}
                    </div>
                </div>
                <div class="card-footer" style="text-align: right;">
                    {{ invite_form.submit_invite(class="btn btn-primary btn-sm") }}
                </div>
            </form>
        </div>
        
        <!-- Student Lists -->
        <div class="card">
            <div class="card-header">
                <h3>My Students</h3>
            </div>
            <div class="card-body">
                <strong>Active Students ({{ active_students|length }})</strong>
                <ul class="item-list" style="margin-top: 0.5rem;">
                    {% for student in active_students %}
                    <li class="item-list-entry" style="padding: 0.5rem 0;">
                        <div>
                            <span class="item-list-entry-name">{{ student.get_display_name() }}</span>
                            <span class="item-list-entry-details">{{ student.email }}</span>
                        </div>
                    </li>
                    {% else %}
                    <li class="item-list-entry" style="padding: 0.5rem 0; border: none;">
                        <span class="item-list-entry-details">No active students yet.</span>
                    </li>
                    {% endfor %}
                </ul>

                <strong style="display: block; margin-top: 1rem;">Pending Invitations ({{ invited_students|length }})</strong>
                <ul class="item-list" style="margin-top: 0.5rem;">
                    {% for invite in invited_students %}
                    <li class="item-list-entry" style="padding: 0.5rem 0;">
                        <div>
                            <span class="item-list-entry-name" style="color: var(--color-text-light);">{{ invite.email }}</span>
                        </div>
                        <a href="#" class="btn btn-sm btn-danger" style="font-size: 0.75rem; padding: 0.2rem 0.4rem;">Revoke</a>
                    </li>
                    {% else %}
                    <li class="item-list-entry" style="padding: 0.5rem 0; border: none;">
                        <span class="item-list-entry-details">No pending invitations.</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Sidebar Navigation Tabs -->
        <div class="card">
            <div class="card-header">
                <h3>Quick Navigation</h3>
            </div>
            <div class="card-body">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('chat') }}">üí¨ Chat</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('resources') }}">üìö Resources</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('knowledge_base') }}">üß† Knowledge Base</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_tools') }}">‚öôÔ∏è Admin</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('upload') }}">‚¨ÜÔ∏è Upload Knowledge</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}